<Window
    x:Class="ReciteHelper.View.ErrorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ReciteHelper.View"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="应用程序异常"
    Width="700"
    Height="600"
    Closing="Window_Closing"
    Icon="pack://application:,,,/ReciteHelper;component/Images/error.png"
    ResizeMode="CanResizeWithGrip"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style TargetType="Button">
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="MinWidth" Value="80" />
        </Style>

        <Style x:Key="ErrorIconStyle" TargetType="Border">
            <Setter Property="Width" Value="48" />
            <Setter Property="Height" Value="48" />
            <Setter Property="CornerRadius" Value="24" />
            <Setter Property="Background" Value="#FFF44336" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <LinearGradientBrush x:Key="HeaderBackground" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Offset="0" Color="#FFF44336" />
            <GradientStop Offset="1" Color="#FFEF5350" />
        </LinearGradientBrush>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border
            Grid.Row="0"
            Padding="20,15"
            Background="{StaticResource HeaderBackground}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  错误图标  -->
                <Border Grid.Column="0" Style="{StaticResource ErrorIconStyle}">
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="24"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="⚠" />
                </Border>

                <StackPanel Grid.Column="1" Margin="15,0,0,0">
                    <TextBlock
                        FontSize="20"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="应用程序异常" />
                    <TextBlock
                        Margin="0,2,0,0"
                        FontSize="14"
                        Foreground="#FFEFEFEF"
                        Text="抱歉，软件遇到了一个意外错误" />
                </StackPanel>
            </Grid>
        </Border>

        <Border
            Grid.Row="1"
            Padding="20"
            Background="#FFF5F5F5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border
                    Grid.Row="0"
                    Margin="0,0,0,10"
                    Padding="15"
                    Background="White"
                    BorderBrush="#FFE0E0E0"
                    BorderThickness="1"
                    CornerRadius="4">
                    <StackPanel>
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="#333"
                            Text="{Binding ExceptionType}" />
                        <TextBlock
                            Margin="0,8,0,0"
                            FontSize="14"
                            Foreground="#666"
                            Text="{Binding ExceptionMessage}" />
                    </StackPanel>
                </Border>

                <Border
                    Grid.Row="1"
                    Background="White"
                    BorderBrush="#FFE0E0E0"
                    BorderThickness="1"
                    CornerRadius="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Border
                            Grid.Row="0"
                            Padding="10"
                            Background="#FAFAFA"
                            BorderBrush="#FFE0E0E0"
                            BorderThickness="0,0,0,1">
                            <TextBlock
                                FontWeight="SemiBold"
                                Foreground="#555"
                                Text="详细信息 (可复制文本)" />
                        </Border>

                        <ScrollViewer
                            Grid.Row="1"
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Auto">
                            <TextBox
                                x:Name="ExceptionDetailsBox"
                                Padding="10"
                                AcceptsReturn="True"
                                Background="Transparent"
                                BorderThickness="0"
                                FontFamily="Consolas, Courier New"
                                FontSize="12"
                                HorizontalScrollBarVisibility="Hidden"
                                IsReadOnly="True"
                                Text="{Binding ExceptionDetails}"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Hidden" />
                        </ScrollViewer>
                    </Grid>
                </Border>

                <Border
                    Grid.Row="2"
                    Margin="0,15,0,0"
                    Padding="15"
                    Background="#FFF3E5F5"
                    BorderBrush="#FFE1BEE7"
                    BorderThickness="1"
                    CornerRadius="4">
                    <StackPanel>
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#7B1FA2"
                            Text="已保存至 error.log" />
                        <TextBlock
                            Margin="0,3,0,0"
                            FontSize="13"
                            Foreground="#9C27B0"
                            Text="请将此异常信息反馈给开发者，帮助修复 Bug 将会进入贡献者名单" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <Border
            Grid.Row="2"
            Padding="15"
            Background="White"
            BorderBrush="#FFE0E0E0"
            BorderThickness="0,1,0,0">
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    x:Name="CopyButton"
                    Background="#2196F3"
                    Click="CopyButton_Click"
                    Content="复制信息"
                    FontWeight="SemiBold"
                    Foreground="White">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="4" />
                        </Style>
                    </Button.Resources>
                </Button>

                <Button
                    x:Name="CloseButton"
                    Margin="10,0,0,0"
                    Background="#F5F5F5"
                    Click="CloseButton_Click"
                    Content="关闭"
                    FontWeight="SemiBold"
                    Foreground="#333">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="4" />
                        </Style>
                    </Button.Resources>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</Window>