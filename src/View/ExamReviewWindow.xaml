<Window
    x:Class="ReciteHelper.View.ExamReviewWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:ReciteHelper.Utils.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ReciteHelper"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="考试答案回顾"
    Width="900"
    Height="700"
    Background="#F5F7F9"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <c:BooleanToResultConverter x:Key="BooleanToResultConverter" />
        <c:BooleanToColorConverter x:Key="BooleanToColorConverter" />

        <Style x:Key="QuestionItemStyle" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E9ECEF" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Margin" Value="0,0,0,10" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <Style
            x:Key="CorrectAnswerStyle"
            BasedOn="{StaticResource QuestionItemStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="#F8FFF9" />
            <Setter Property="BorderBrush" Value="#D4EDDA" />
        </Style>

        <Style
            x:Key="WrongAnswerStyle"
            BasedOn="{StaticResource QuestionItemStyle}"
            TargetType="Border">
            <Setter Property="Background" Value="#FFF9F9" />
            <Setter Property="BorderBrush" Value="#F8D7DA" />
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#007ACC" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="20,10" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="MinWidth" Value="100" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#005A9E" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border
            Grid.Row="0"
            Padding="20,15"
            Background="White"
            BorderBrush="#E9ECEF"
            BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock
                        FontSize="18"
                        FontWeight="Bold"
                        Foreground="#333333"
                        Text="考试答案回顾" />
                    <TextBlock
                        x:Name="ExamInfoText"
                        Margin="0,4,0,0"
                        FontSize="12"
                        Foreground="#666666"
                        Text="模拟考试 - 答题详情" />
                </StackPanel>

                <StackPanel
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <TextBlock
                        x:Name="ScoreSummaryText"
                        Margin="0,0,30,0"
                        VerticalAlignment="Center"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Foreground="#007ACC"
                        Text="得分：0/0" />
                    <Button
                        Click="CloseButton_Click"
                        Content="关闭"
                        Style="{StaticResource PrimaryButtonStyle}" />
                </StackPanel>
            </Grid>
        </Border>

        <ScrollViewer
            Grid.Row="1"
            Padding="20"
            VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="ReviewItemsControl">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{Binding ItemStyle}">
                            <Grid Margin="20">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <StackPanel
                                    Grid.Row="0"
                                    Margin="0,0,0,10"
                                    Orientation="Horizontal">
                                    <TextBlock
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Foreground="#007ACC"
                                        Text="{Binding QuestionNumber, StringFormat='第{0}题'}" />
                                    <Border
                                        Margin="10,0,0,0"
                                        Padding="8,2"
                                        Background="{Binding IsCorrect, Converter={StaticResource BooleanToColorConverter}}"
                                        CornerRadius="10">
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            FontSize="11"
                                            FontWeight="SemiBold"
                                            Foreground="White"
                                            Text="{Binding IsCorrect, Converter={StaticResource BooleanToResultConverter}}" />
                                    </Border>
                                </StackPanel>

                                <StackPanel
                                    Grid.Row="1"
                                    Margin="0,0,0,8"
                                    Orientation="Vertical">
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontWeight="SemiBold"
                                        Foreground="#495057"
                                        Text="题目：" />
                                    <TextBlock
                                        FontSize="13"
                                        Foreground="#333333"
                                        LineHeight="20"
                                        Text="{Binding QuestionContent}"
                                        TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel
                                    Grid.Row="2"
                                    Margin="0,0,0,4"
                                    Orientation="Horizontal">
                                    <TextBlock
                                        MinWidth="80"
                                        FontWeight="SemiBold"
                                        Foreground="#495057"
                                        Text="您的答案：" />
                                    <TextBlock
                                        FontSize="13"
                                        Foreground="#333333"
                                        Text="{Binding UserAnswer}"
                                        TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel
                                    Grid.Row="3"
                                    Margin="0,0,0,4"
                                    Orientation="Horizontal">
                                    <TextBlock
                                        MinWidth="80"
                                        FontWeight="SemiBold"
                                        Foreground="#495057"
                                        Text="正确答案：" />
                                    <TextBlock
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        Foreground="#28A745"
                                        Text="{Binding CorrectAnswer}"
                                        TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel
                                    Grid.Row="4"
                                    Margin="0,8,0,0"
                                    Orientation="Vertical"
                                    Visibility="{Binding HasExplanation, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock
                                        Margin="0,0,0,4"
                                        FontWeight="SemiBold"
                                        Foreground="#495057"
                                        Text="解析：" />
                                    <TextBlock
                                        FontSize="12"
                                        FontStyle="Italic"
                                        Foreground="#666666"
                                        LineHeight="18"
                                        Text="{Binding Explanation}"
                                        TextWrapping="Wrap" />
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <Border
            Grid.Row="2"
            Padding="20,15"
            Background="#F8F9FA"
            BorderBrush="#E9ECEF"
            BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="12"
                            Foreground="#666666"
                            Text="总题数：" />
                        <TextBlock
                            x:Name="TotalQuestionsText"
                            Margin="5,0,0,0"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#333333"
                            Text="0" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="12"
                            Foreground="#666666"
                            Text="答对：" />
                        <TextBlock
                            x:Name="CorrectCountText"
                            Margin="5,0,0,0"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#28A745"
                            Text="0" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="12"
                            Foreground="#666666"
                            Text="答错：" />
                        <TextBlock
                            x:Name="WrongCountText"
                            Margin="5,0,0,0"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#DC3545"
                            Text="0" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="12"
                            Foreground="#666666"
                            Text="正确率：" />
                        <TextBlock
                            x:Name="AccuracyText"
                            Margin="5,0,0,0"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#007ACC"
                            Text="0%" />
                    </StackPanel>
                </StackPanel>

                <StackPanel
                    Grid.Column="1"
                    Margin="0,0,20,0"
                    Orientation="Horizontal">
                    <Button
                        Click="ExportReportButton_Click"
                        Content="导出报告"
                        Style="{StaticResource PrimaryButtonStyle}" />
                </StackPanel>

                <Button
                    Grid.Column="2"
                    Background="Transparent"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1"
                    Click="CloseButton_Click"
                    Content="返回"
                    Foreground="#666666"
                    Style="{StaticResource PrimaryButtonStyle}" />
            </Grid>
        </Border>
    </Grid>
</Window>